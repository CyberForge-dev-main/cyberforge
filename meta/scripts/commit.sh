#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∫–æ–º–º–∏—Ç–∞ –≤ CyberForge

if [ -z "$1" ]; then
    echo "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: bash scripts/commit.sh \"—Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞\""
    echo "–ü—Ä–∏–º–µ—Ä: bash scripts/commit.sh \"Add Backend Flask app\""
    exit 1
fi

COMMIT_MSG="$1"

echo "üìù –ö–æ–º–º–∏—Ç: $COMMIT_MSG"
echo ""

# –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
echo "‚ñ∂ –ü—Ä–æ–≤–µ—Ä–∫–∞ Git —Å—Ç–∞—Ç—É—Å–∞..."
if ! git status > /dev/null 2>&1; then
    echo "‚úó –û—à–∏–±–∫–∞ Git"
    exit 1
fi

# –®–∞–≥ 2: –ü–æ–∫–∞–∑–∞—Ç—å —á—Ç–æ –±—É–¥–µ—Ç –∫–æ–º–º–∏—á–µ–Ω–æ
echo "‚ñ∂ –ò–∑–º–µ–Ω–µ–Ω–∏—è:"
git status --short | sed 's/^/  /'
echo ""

# –®–∞–≥ 3: –ó–∞–ø—Ä–æ—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
read -p "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∫–æ–º–º–∏—Ç? (y/n): " -n 1 -r
echo
if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    echo "–û—Ç–º–µ–Ω–µ–Ω–æ"
    exit 0
fi

# –®–∞–≥ 4: –î–æ–±–∞–≤–∏—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã
echo "‚ñ∂ –î–æ–±–∞–≤–ª—è—é —Ñ–∞–π–ª—ã..."
git add -A

# –®–∞–≥ 5: –ö–æ–º–º–∏—Ç (pre-commit hook –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
echo "‚ñ∂ –ö–æ–º–º–∏—Ç..."
git commit -m "$COMMIT_MSG"

if [ $? -eq 0 ]; then
    echo ""
    echo "‚úì –ö–æ–º–º–∏—Ç —É—Å–ø–µ—à–µ–Ω!"
    echo ""
    echo "‚ñ∂ –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ GitHub..."
    git push origin main
    
    if [ $? -eq 0 ]; then
        echo "‚úì –ó–∞–≥—Ä—É–∂–µ–Ω–æ –Ω–∞ GitHub!"
    else
        echo "‚ö† –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å (–º–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–∑–∂–µ)"
    fi
else
    echo "‚úó –û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–º–º–∏—Ç–µ (–ø—Ä–æ–≤–µ—Ä—å—Ç–µ pre-commit hook)"
    exit 1
fi
