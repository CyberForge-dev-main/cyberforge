name: Docker Build

on:
  push:
    branches: [ main ]
    tags:
      - 'v*'

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Build Challenge 1
      run: docker build -f challenges/ch1/Dockerfile -t cyberforge-ch1 .
      
    - name: Build Challenge 2
      run: docker build -f challenges/ch2/Dockerfile -t cyberforge-ch2 .
      
    - name: Build Challenge 3
      run: docker build -f challenges/ch3/Dockerfile -t cyberforge-ch3 .
      
    - name: Build Backend
      run: docker build -f backend/Dockerfile -t cyberforge-backend ./backend
      
    - name: Test containers start
      run: docker compose up -d && sleep 5 && docker compose ps
      
    - name: Clean up
      run: docker compose down
